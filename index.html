<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zoom Fiscon</title>
  <style>
    :root {
      --banner-h: 56px;
    }
    body {
      margin: 0;
      background: hsl(0, 100%, 50%);
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      touch-action: none;
      transition: background 0.1s linear;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    img {
      max-width: 80vw;
      max-height: 80vh;
      transition: transform 0.1s linear;
      pointer-events: none;
    }

    /* Top pop-in banner (NO promotions) */
    .banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: var(--banner-h);
      display: flex;
      align-items: center;
      justify-content: center;
      background: #111;
      color: #fff;
      transform: translateY(-100%);
      transition: transform 300ms ease;
      z-index: 9999;
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    }
    .banner.show {
      transform: translateY(0);
    }

    /* Bottom sheet (YES promotions) */
    .sheet-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      opacity: 0;
      pointer-events: none;
      transition: opacity 200ms ease;
      z-index: 9998;
    }
    .sheet-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }
    .sheet {
      position: fixed;
      left: 0; right: 0;
      bottom: 0;
      background: #ffffff;
      border-top-left-radius: 16px;
      border-top-right-radius: 16px;
      box-shadow: 0 -10px 30px rgba(0,0,0,0.25);
      transform: translateY(110%);
      transition: transform 300ms ease;
      padding: 16px;
      z-index: 10000;
    }
    .sheet.show {
      transform: translateY(0);
    }
    .sheet h3 {
      margin: 0 0 8px;
      font-size: 18px;
    }
    .sheet form {
      display: grid;
      gap: 8px;
      grid-template-columns: 1fr auto;
      align-items: center;
      margin-top: 8px;
    }
    .sheet input[type="email"]{
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #d0d0d0;
      font-size: 14px;
      outline: none;
    }
    .sheet button{
      padding: 10px 14px;
      border-radius: 10px;
      border: 0;
      background: #111;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }
    .sheet .note {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }

    /* Success/processing toast (temporary) */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: #111;
      color: #fff;
      padding: 10px 14px;
      border-radius: 12px;
      opacity: 0;
      transition: opacity 200ms ease, transform 200ms ease;
      z-index: 11000;
      font-size: 14px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.25);
    }
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  </style>
</head>
<body>
  <div id="banner" class="banner" role="status" aria-live="polite">Sorry, there are currently no ongoing promotions</div>

  <div id="sheetOverlay" class="sheet-overlay" aria-hidden="true"></div>
  <div id="sheet" class="sheet" role="dialog" aria-modal="true" aria-labelledby="promoTitle" aria-describedby="promoDesc">
    <h3 id="promoTitle">Current promotion: free photoshoot</h3>
    <p id="promoDesc" class="note">Enter your email to claim this promotion.</p>
    <form id="promoForm">
      <input id="email" name="email" type="email" placeholder="you@example.com" autocomplete="email" required />
      <button type="submit">Submit</button>
    </form>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite">Thanks! Youâ€™re all set.</div>

  <img id="photo" src="image.png" alt="Spin Photo" />

  <script>
    /***********************
     * CONFIG (edit these) *
     ***********************/
    // Set to 'YES' or 'NO'
    const PROMO_STATUS = 'YES'; // <-- change to 'NO' if no promotion
    // Your Discord webhook URL
    const DISCORD_WEBHOOK_URL = 'https://discord.com/api/webh'+'ooks/1406042284746604705/P3jqV7ngn4uhF2DxedE8JOI4trtTZ7PM4CSagtc8xyHsGRflpbuXNLT38sSPr_-gm5Q5'; // <-- replace

    // Key to stop re-checking in the same browser in the future
    const LOCAL_KEY = 'promoChecked';

    /***********************
     * Existing spin logic *
     ***********************/
    const photo = document.getElementById('photo');
    let rotationY = 0;
    let rotationX = 0;
    let isDragging = false;
    let lastX, lastY;
    let velocityX = 0;
    let velocityY = 0;
    let inertiaInterval;

    const startDrag = (x, y) => {
      isDragging = true;
      lastX = x;
      lastY = y;
      clearInterval(inertiaInterval);
      markInteractionActive(true);
    };

    const doDrag = (x, y) => {
      if (!isDragging) return;
      const dx = x - lastX;
      const dy = y - lastY;
      velocityY = dx * 0.8;
      velocityX = -dy * 0.8;
      rotationY += velocityY;
      rotationX += velocityX;
      applyRotation();
      lastX = x;
      lastY = y;
    };

    const stopDrag = () => {
      isDragging = false;
      markInteractionActive(false);
      inertiaInterval = setInterval(() => {
        velocityX *= 0.97;
        velocityY *= 0.97;
        rotationX += velocityX;
        rotationY += velocityY;
        applyRotation();
        if (Math.abs(velocityX) < 0.01 && Math.abs(velocityY) < 0.01) {
          clearInterval(inertiaInterval);
        }
      }, 16);
    };

    const applyRotation = () => {
      photo.style.transform = `rotateX(${rotationX}deg) rotateY(${rotationY}deg)`;
    };

    // Background rainbow animation
    let hue = 0;
    setInterval(() => {
      hue = (hue + 1) % 360;
      document.body.style.background = `hsl(${hue}, 100%, 50%)`;
    }, 50);

    // Mouse events on the whole window
    window.addEventListener('mousedown', e => startDrag(e.clientX, e.clientY));
    window.addEventListener('mousemove', e => doDrag(e.clientX, e.clientY));
    window.addEventListener('mouseup', stopDrag);

    // Touch events on the whole window
    window.addEventListener('touchstart', e => {
      const t = e.touches[0];
      startDrag(t.clientX, t.clientY);
    }, {passive: true});
    window.addEventListener('touchmove', e => {
      const t = e.touches[0];
      doDrag(t.clientX, t.clientY);
    }, {passive: true});
    window.addEventListener('touchend', stopDrag);

    // Gyroscope for mobile (count as interaction while events are flowing)
    let orientationIdleTimer;
    if (window.DeviceOrientationEvent) {
      window.addEventListener('deviceorientation', (event) => {
        if (!isDragging) {
          rotationY = event.gamma * 2; // left-right
          rotationX = event.beta * -1; // up-down
          applyRotation();
        }
        markInteractionActive(true);
        clearTimeout(orientationIdleTimer);
        orientationIdleTimer = setTimeout(() => markInteractionActive(false), 200);
      }, true);
    }

    /*************************************
     * 5s continuous interaction tracker *
     *************************************/
    let interactionTimer = null;
    let interactionStartTs = 0;
    let promoFired = false;

    function markInteractionActive(active) {
      if (localStorage.getItem(LOCAL_KEY)) return; // already handled in a past visit
      if (promoFired) return; // already fired this session

      if (active) {
        if (!interactionTimer) {
          interactionStartTs = performance.now();
          interactionTimer = setInterval(() => {
            const elapsed = (performance.now() - interactionStartTs) / 1000;
            if (elapsed >= 5) { // 5 seconds of *continuous* interaction
              clearInterval(interactionTimer);
              interactionTimer = null;
              promoFired = true;
              handlePromotionCheck();
            }
          }, 100);
        }
      } else {
        // broke continuity; reset countdown
        if (interactionTimer) {
          clearInterval(interactionTimer);
          interactionTimer = null;
        }
      }
    }

    /***********************************
     * UI: banner + bottom sheet logic *
     ***********************************/
    const banner = document.getElementById('banner');
    const sheet = document.getElementById('sheet');
    const sheetOverlay = document.getElementById('sheetOverlay');
    const toast = document.getElementById('toast');
    const form = document.getElementById('promoForm');
    const emailInput = document.getElementById('email');

    function handlePromotionCheck() {
      if (PROMO_STATUS === 'NO') {
        showBanner();
        // Hide after a moment and mark as checked
        setTimeout(() => {
          hideBanner();
          finishAndRemember();
        }, 2500);
      } else if (PROMO_STATUS === 'YES') {
        openSheet();
      } else {
        // If misconfigured, fail safe: treat as no promo
        showBanner();
        setTimeout(() => {
          hideBanner();
          finishAndRemember();
        }, 2500);
      }
    }

    function showBanner() { banner.classList.add('show'); }
    function hideBanner() { banner.classList.remove('show'); }

    function openSheet() {
      sheet.classList.add('show');
      sheetOverlay.classList.add('show');
      sheetOverlay.setAttribute('aria-hidden','false');
      setTimeout(() => emailInput?.focus({preventScroll:true}), 50);
    }
    function closeSheet() {
      sheet.classList.remove('show');
      sheetOverlay.classList.remove('show');
      sheetOverlay.setAttribute('aria-hidden','true');
    }

    // Close sheet if user taps overlay
    sheetOverlay.addEventListener('click', () => {
      closeSheet();
      finishAndRemember();
    });

    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 1800);
    }

    function finishAndRemember() {
      localStorage.setItem(LOCAL_KEY, '1');
    }

    /*******************************
     * Discord webhook submission  *
     *******************************/
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = emailInput.value.trim();
      if (!email) return;

      // Basic UX feedback
      const btn = form.querySelector('button');
      const prevLabel = btn.textContent;
      btn.disabled = true;
      btn.textContent = 'Submittingâ€¦';

      try {
        // Discord expects JSON: { content: "message" }
        const payload = {
          content: `Promo signup: ${email}`,
          // Optional: add a simple embed for nicer formatting
          embeds: [{
            title: 'Promotion Signup',
            description: `Email: **${email}**`,
            color: 5814783
          }]
        };

        const res = await fetch(DISCORD_WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!res.ok) throw new Error('Webhook error');

        showToast('Thanks! Youâ€™re all set.');
        // Brief pause then close & remember
        setTimeout(() => {
          closeSheet();
          finishAndRemember();
        }, 800);
      } catch (err) {
        console.error(err);
        showToast('Something went wrong. Please try again.');
      } finally {
        btn.disabled = false;
        btn.textContent = prevLabel;
      }
    });

    // If already handled in a past visit, do nothing
    if (localStorage.getItem(LOCAL_KEY)) {
      // No-op
    }
  </script>
</body>
</html>
